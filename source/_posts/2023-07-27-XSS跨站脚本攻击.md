---
title: XSS跨站脚本攻击
categories:
  - 技术文档
date: 2023-07-27 16:07:51
tags:
  - 前端安全
  - XSS
---

## 介绍

跨站脚本攻击（Cross-Site Scripting，简称 XSS）是一种常见的网络攻击方式，攻击者通过在网页中注入恶意脚本，从而获取用户的敏感信息或者控制用户的浏览器。XSS 攻击的危害和影响非常大，例如窃取用户的账号密码、篡改网页内容、发起 CSRF 攻击等，因此需要引起足够的重视。

在 2018 年，Facebook 曾经因为一个 XSS 漏洞而泄露了 5000 万用户的个人信息，这个事件引起了广泛的关注和讨论。这个事件也说明了 XSS 攻击的危害和影响有多么严重。

## XSS 的类型

XSS 攻击可以分为三种类型：
- 存储型 XSS，存储型 XSS 攻击是指攻击者将恶意脚本存储在服务器端，当用户访问包含恶意脚本的页面时，恶意脚本会被执行。
- 反射型 XSS，反射型 XSS 攻击是指攻击者将恶意脚本作为参数传递给服务器，服务器将恶意脚本反射回用户的浏览器，从而执行恶意脚本。
- 基于 DOM 的 XSS。基于 DOM 的 XSS 攻击是指攻击者利用浏览器的 DOM 解析机制，通过修改页面的 DOM 结构来执行恶意脚本。

## XSS 的攻击方式

攻击者可以通过多种方式利用 XSS 攻击漏洞，例如在表单中注入恶意脚本、在 URL 中注入恶意脚本、在 Cookie 中注入恶意脚本等。攻击者还可以通过构造恶意脚本来实现各种攻击目的，例如窃取用户的敏感信息、篡改网页内容、发起 CSRF 攻击等。


## 预防 XSS 攻击

为了预防 XSS 攻击，我们可以采取以下措施：  
- 输入验证和过滤：对用户输入的数据进行验证和过滤，防止恶意脚本被注入到网页中。例如，可以使用正则表达式过滤掉 HTML 标签和 JavaScript 代码。
- 输出编码和转义：对输出到网页中的数据进行编码和转义，防止恶意脚本被执行。例如，可以使用 HTML 实体编码和 JavaScript 转义。
- 使用 Content Security Policy（CSP）：CSP 是一种安全策略，可以限制网页中可以执行的脚本和资源，从而有效地防止 XSS 攻击。例如，可以设置只允许加载来自特定域名的脚本和资源。

## 实例分析

假设我们有一个简单的博客应用，用户可以在博客中发表文章和评论。我们来看一下如何防止 XSS 攻击。

### 输入验证和过滤

我们可以对用户输入的数据进行验证和过滤，例如过滤掉 HTML 标签和 JavaScript 代码。这样可以防止攻击者在评论中注入恶意脚本。

例如，我们可以使用 Node.js 的 escape-html 模块对用户输入的数据进行编码，将特殊字符转换为 HTML 实体。这样可以防止恶意脚本被执行。

``` javascript
const escapeHtml = require('escape-html');

// 过滤用户输入的评论内容
const comment = escapeHtml(req.body.comment);
```

### 输出编码和转义

我们可以对输出到网页中的数据进行编码和转义，例如使用 HTML 实体编码和 JavaScript 转义。这样可以防止恶意脚本被执行。

例如，我们可以使用 JavaScript 的 encodeURIComponent() 函数对用户输入的数据进行编码，将特殊字符转换为 URL 编码。这样可以防止恶意脚本被注入到 URL 中。

``` javascript
// 输出评论内容到网页中
var comment = document.createElement('div');
comment.innerHTML = encodeURIComponent(data.comment);
document.getElementById('comments').appendChild(comment);
```

### Content Security Policy（CSP）

我们可以在网页中添加 CSP 头，限制网页中可以执行的脚本和资源。例如，我们可以设置只允许加载来自特定域名的脚本和资源。

例如，我们可以在网页的 HTTP 头中添加 CSP 头，限制只允许加载来自 example.com 域名的脚本和资源。

``` javascript
Content-Security-Policy: default-src 'self'; script-src 'self' example.com
```

这样可以有效地防止 XSS 攻击。
  
## 总结

XSS 攻击是一种常见的网络攻击方式，攻击者可以通过注入恶意脚本来获取用户的敏感信息或者控制用户的浏览器。为了预防 XSS 攻击，我们可以采取多种措施，例如输入验证和过滤、输出编码和转义、使用 Content Security Policy（CSP）等。在开发网页应用时，我们应该时刻关注 XSS 攻击的风险，并采取相应的安全措施。  

如果你想深入了解 XSS 攻击和预防措施，可以参考以下资料：  
- [OWASP XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- [Content Security Policy (CSP)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- [Cross-site Scripting](https://portswigger.net/web-security/cross-site-scripting)